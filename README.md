# lnkr

A simple CLI tool for managing hard links and symbolic links with configuration files.

## Overview

`lnkr` helps you manage links between local and remote directories using a `.lnkr.toml` configuration file. It automatically handles git exclusions and supports both hard links and symbolic links.

When you add a file with `lnkr add`, it moves the file to the remote directory and creates a link back to the local location. This is useful for syncing configuration files to cloud storage while keeping them accessible in your project.

## Installation

```bash
# From source
go build -o lnkr .

# Using go install
go install github.com/longkey1/lnkr@latest
```

## Quick Start

```bash
# 1. Initialize project
lnkr init --remote /backup/project

# 2. Add files to link (moves to remote and creates link)
lnkr add important.txt
lnkr add config/

# 3. Check status
lnkr status

# 4. Remove links when done
lnkr unlink

# 5. Re-create links (e.g., after cloning)
lnkr link
```

## Commands

### init
Initialize a new lnkr project.

```bash
# Basic initialization
lnkr init

# With remote directory
lnkr init --remote /path/to/remote

# Create remote directory if it doesn't exist
lnkr init --remote /path/to/remote --with-create-remote

# Custom git exclude path
lnkr init --git-exclude-path .gitignore
```

### add
Add files or directories to the link configuration. This command:
1. Moves the specified file/directory from local to remote
2. Creates a link from remote back to local
3. Updates the GitExclude file

```bash
# Add single file (sym link by default)
lnkr add file.txt

# Add with hard link
lnkr add file.txt --type hard

# Add directory (sym link)
lnkr add directory/

# Add directory recursively with hard links (for all files)
lnkr add directory/ --type hard --recursive
```

### link
Create links based on configuration. Links are created from remote to local (remote is the source, local is the link target). This is useful when setting up a new machine or after cloning a repository.

```bash
lnkr link
```

### unlink
Remove all links from the filesystem. This will also remove all link paths from the GitExclude file.

```bash
lnkr unlink
```

### status
Check the status of configured links.

```bash
lnkr status
```

### remove
Remove entries from the configuration. This will also update the GitExclude file with the remaining link paths.

```bash
lnkr remove path/to/remove
```

### switch
Switch the link type of an existing entry.

```bash
# Switch to hard link
lnkr switch file.txt hard

# Switch to symbolic link
lnkr switch file.txt sym

# Toggle (sym ↔ hard)
lnkr switch file.txt

# Switch directory (recursive)
lnkr switch mydir/ hard  # sym -> hard: expands to individual file entries
lnkr switch mydir/ sym   # hard -> sym: consolidates to single directory entry
```

For directories:
- **sym → hard**: Removes symlink, creates hard links for all files (entries expand in config)
- **hard → sym**: Removes hard links, creates single symlink (entries consolidate in config)

### clean
Remove configuration file and clean up git exclusions.

```bash
lnkr clean
```

## Configuration (.lnkr.toml)

The `.lnkr.toml` file is automatically managed as a symbolic link to the remote directory. You don't need to add it to `[[links]]` - it is implicitly included.

### Path formats

Paths can be specified as:
- **Placeholders**: `{{remote_root}}`, `{{local_root}}` (env > config > default priority)
- **Environment variables**: `$HOME`, `$PWD`, or any environment variable (manual editing only)
- **Absolute paths**: `/Users/me/workspace`

When you run `lnkr init`, paths are automatically saved using `{{remote_root}}` and `{{local_root}}` placeholders (if configured in global config), or absolute paths as fallback. Environment variables like `$HOME` are NOT used by `lnkr init` for better portability, but can be manually added to config files and will be expanded correctly.

```toml
# Using placeholders (automatically generated by init when global config is set)
local = "{{local_root}}/github.com/user/project"
remote = "{{remote_root}}/github.com/user/project"

# Or absolute paths (fallback when path doesn't match local_root/remote_root)
local = "/Users/me/src/github.com/user/project"
remote = "/Users/me/.config/lnkr/github.com/user/project"

# Environment variables can be manually added and will work correctly
local = "$HOME/src/github.com/user/project"  # manual edit
remote = "{{remote_root}}/github.com/user/project"

link_type = "sym"  # or "hard"; default is "sym"
git_exclude_path = ".git/info/exclude"

[[links]]
path = "file.txt"
type = "sym"

[[links]]
path = "config/"
type = "sym"
```

**Supported placeholders** (env > config > default priority):
- `{{remote_root}}` - remote files directory
- `{{local_root}}` - base directory for local paths

**Supported environment variables** (manual editing only):
- `$HOME`, `$PWD`, and any environment variable can be used in config files
- `lnkr init` does NOT automatically use these for better portability

## Global Configuration

You can configure default settings in `~/.config/lnkr/config.toml`:

```toml
remote_root = "/path/to/your/dotfiles"
local_root = "/Users/me/src"
link_type = "sym"
git_exclude_path = ".git/info/exclude"
```

| Setting | Description | Default |
|---------|-------------|---------|
| `remote_root` | Base directory for remote paths | `$HOME/.config/lnkr` |
| `local_root` | Base directory for calculating relative paths | (empty: uses current dir name only) |
| `link_type` | Default link type (`sym` or `hard`) | `sym` |
| `git_exclude_path` | Path to git exclude file | `.git/info/exclude` |

### How `local_root` works

When `local_root` is set, the relative path from `local_root` to the current directory is used as the remote path:

```
local_root = "/Users/me/src"
remote_root = "/backup/dotfiles"

# In /Users/me/src/github.com/user/project:
# → remote = /backup/dotfiles/github.com/user/project
```

When `local_root` is empty, only the current directory name is used:

```
# In /Users/me/src/github.com/user/project:
# → remote = /backup/dotfiles/project
```

## Environment Variables

Environment variables can override config file settings:

| Variable | Overrides |
|----------|-----------|
| `LNKR_REMOTE_ROOT` | `remote_root` |
| `LNKR_LOCAL_ROOT` | `local_root` |
| `LNKR_LINK_TYPE` | `link_type` |
| `LNKR_GIT_EXCLUDE_PATH` | `git_exclude_path` |

**Priority**: Environment variables > Config file > Default values

Note: For `.lnkr.toml` paths, `{{remote_root}}` and `{{local_root}}` placeholders are recommended over environment variables for better portability. The `init` command automatically uses these placeholder formats when global config is set, or falls back to absolute paths.

## Link Types

- **Symbolic Links (`sym`)**: Point to the original file/directory (default, use `--type sym` or no flag)
- **Hard Links (`hard`)**: Share the same inode as the original file (use `--type hard`)

Note: Hard links can only be created for files, not directories. Use `--recursive` flag to add all files in a directory as hard links.

For backward compatibility, `symbolic` is also accepted as an alias for `sym`.

## How It Works

1. **Add**: When you run `lnkr add myfile.txt`, the file is moved from `local/myfile.txt` to `remote/myfile.txt`, and a link is created at `local/myfile.txt` pointing to `remote/myfile.txt`.

2. **Link**: When you run `lnkr link` (e.g., on a new machine), it creates links from remote to local for all configured entries.

3. **Unlink**: Removes the links from the local directory (remote files remain intact).

## Platform Support

- Linux (AMD64, ARM64, ARMv6, ARMv7)
- macOS (AMD64, ARM64)

Windows is not supported due to filesystem differences.
